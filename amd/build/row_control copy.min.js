define(["jquery","gradeexport_ilp_push/page_info","core/templates","core/str","core/log"],function(a,b,c,d,e){var f={failGrades:!1,incompleteGrades:!1,initAll:function(){a(".gradingtable .usergraderow").each(function(){f.initRow(a(this))})},initRow:function(c){var d=c.find(".gradeselect").eq(0);d.change(function(){var d=a(this).val();b.gradeIsIncomplete(d)?(c.find(".incomplete").show(),c.find(".fail").hide()):b.gradeIsFailure(d)?(c.find(".incomplete").hide(),c.find(".fail").show()):(c.find(".incomplete").hide(),c.find(".fail").hide()),f.updateVerification(c)}),c.find(".incompletedeadline input").eq(0).change(function(){f.updateVerification(c)}),c.find(".datelastattended input").eq(0).change(function(){f.updateVerification(c)}),c.find(".incompletegradeselect").eq(0).change(function(){f.updateVerification(c)}),f.updateVerification(c)},updateFormWarning:function(a,b,f,g){var h=a.find(b);if(h)return h=h.eq(0),f?void d.get_string(f,"gradeexport_ilp_push",g).done(function(a){c.renderPix("i/warning","core",a).then(function(a){h.html(a)}).fail(function(){e.debug("Failed to fetch the warning icon")})}):void h.html("")},updateVerification:function(a){if(!a.hasClass("locked")){var c=a.find(".gradeselect").eq(0),d=c.val(),e=a.find(".confirmcheckbox").eq(0),g=a.find(".grade .letter").eq(0).data("grade-key"),h=a.find(".grade .notequal").eq(0);g!=d?h.show():h.hide();var i=!1,j=!1,k="";if(d||(j=!0,k="invalid_grade"),f.updateFormWarning(a,".gradeerror",k),b.gradeIsIncomplete(d)){i=a.find(".incompletedeadline input").eq(0),k="",""==i.val()?(j=!0,k="invalid_incomplete_date"):b.isAllowedIncompleteDeadline(i.val())||(j=!0,k="invalid_incomplete_date"),f.updateFormWarning(a,".incompletedateerror",k,b.getStringIncompleteDeadline());var l=a.find(".incompletegradeselect").eq(0);k="",b.isAllowedIncompleteGrade(l.val())||(j=!0,k="invalid_incomplete_grade"),f.updateFormWarning(a,".incompletegradeerror",k,b.getIncompleteGrade())}else b.gradeIsFailure(d)&&(i=a.find(".datelastattended input").eq(0),k="",""==i.val()?(j=!0,k="invalid_datelastattended"):b.isAllowedLastAttendDate(i.val())||(j=!0,k="invalid_datelastattended"),f.updateFormWarning(a,".datelastattendederror",k,b.getStringLastAttendDates()));j?e.prop("disabled",!0):e.prop("disabled",!1)}}};return f});