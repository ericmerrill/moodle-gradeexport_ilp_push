define(["jquery","gradeexport_ilp_push/page_info","core/templates","core/str","core/log"],function(a,b,c,d,e){var f={failGrades:!1,incompleteGrades:!1,initAll:function(){a(".gradingtable .usergraderow").each(function(){f.initRow(a(this))})},initRow:function(c){var d=c.find(".gradeselect").eq(0);d.change(function(){var d=a(this).val();b.gradeIsIncomplete(d)?(c.find(".incomplete").show(),c.find(".fail").hide()):b.gradeIsFailure(d)?(c.find(".incomplete").hide(),c.find(".fail").show()):(c.find(".incomplete").hide(),c.find(".fail").hide()),f.updateVerification(c)}),c.find(".incompletedeadline input").eq(0).change(function(){f.updateVerification(c)}),c.find(".datelastattended input").eq(0).change(function(){f.updateVerification(c)}),c.find(".incompletegradeselect").eq(0).change(function(){f.updateVerification(c)}),f.updateVerification(c)},updateFormWarning:function(a,b,f,g){var h=a.find(b);if(h)return h=h.eq(0),f?void d.get_string(f,"gradeexport_ilp_push",g).done(function(a){c.renderPix("i/warning","core",a).then(function(a){h.html(a)}).fail(function(){e.debug("Failed to fetch the warning icon")})}):void h.html("")},updateVerification:function(a){var c=a.find(".gradeselect").eq(0),d=c.val(),e=a.find(".confirmcheckbox").eq(0),g=!1,h=!1,i="";if(d||(h=!0,i="invalid_grade"),f.updateFormWarning(a,".gradeerror",i),b.gradeIsIncomplete(d)){g=a.find(".incompletedeadline input").eq(0),i="",""==g.val()?(h=!0,i="invalid_incomplete_date"):b.isAllowedIncompleteDeadline(g.val())||(h=!0,i="invalid_incomplete_date"),f.updateFormWarning(a,".incompletedateerror",i,b.getStringIncompleteDeadline());var j=a.find(".incompletegradeselect").eq(0);i="",b.isAllowedIncompleteGrade(j.val())||(h=!0,i="invalid_incomplete_grade"),f.updateFormWarning(a,".incompletegradeerror",i,b.getIncompleteGrade())}else b.gradeIsFailure(d)&&(g=a.find(".datelastattended input").eq(0),i="",""==g.val()?(h=!0,i="invalid_datelastattended"):b.isAllowedLastAttendDate(g.val())||(h=!0,i="invalid_datelastattended"),f.updateFormWarning(a,".datelastattendederror",i,b.getStringLastAttendDates()));h?e.prop("disabled",!0):e.prop("disabled",!1)}};return f});